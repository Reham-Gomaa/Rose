<div class="form-header mb-4">
  <h2>
    {{ getFormTitle() }}
  </h2>
</div>

<form [formGroup]="entityForm" (ngSubmit)="onSubmit()" class="p-fluid">
  <div class="flex flex-column gap-4">
    <!-- Name Field -->
    <lib-custom-input
      id="entityName"
      [labelText]="getFieldLabel('name')"
      [placeholder]="getFieldPlaceholder('name')"
      [errorHandilgControl]="nameControl"
      formControlName="name"
    >
    </lib-custom-input>

    <!-- Image Section - Different for Edit vs Add mode -->
    @if (isEditMode) {
      <!-- EDIT MODE: Show view image link only (without label) -->
      <div class="flex flex-column gap-2">
        @if (previewUrl) {
          <button
            type="button"
            (click)="openImageModal()"
            class="p-button-text"
          >
            {{ getViewImageText() }}
          </button>
        } @else {
          <span class="text-gray-500 text-sm">{{ getNoImageText() }}</span>
        }
      </div>
    } @else {
      <!-- ADD MODE: Show file upload with label -->
      <div class="flex flex-column gap-2">
        <lib-custom-input
          type="file"
          accept="image/*"
          [labelText]="getFieldLabel('image')"
          [placeholder]="getFieldPlaceholder('image')"
          [errorHandilgControl]="entityForm.get('image') ?? undefined"
          formControlName="image"
          (change)="onFileSelected($event)"
        >
        </lib-custom-input>

        <!-- Show new image preview for add mode -->
        @if (previewUrl && selectedFile) {
          <div class="image-preview mt-2">
            <p class="text-sm text-gray-600 mb-1">{{ getImagePreviewText() }}</p>
            <img
              [ngSrc]="previewUrl"
              [alt]="getFieldLabel('image')"
              loading="lazy"
              class="preview-image cursor-pointer"
              (click)="openImageModal()"
              style="max-width: 200px; max-height: 150px; border-radius: 8px"
            />
          </div>
        }
      </div>
    }

    <lib-form-button
      type="submit"
      [text]="getSubmitButtonText()"
      [loadingText]="getLoadingText()"
      [disabled]="entityForm.invalid"
      [isLoading]="isSubmitting"
      [fullWidth]="true"
    >
    </lib-form-button>
  </div>
</form>

<p-dialog
  [header]="modalImageTitle"
  [(visible)]="showImageModal"
  [modal]="true"
  [style]="{ width: '50rem',background: 'var(--modal-pop-up-bg)',color: 'var(--input-text-color)', }" 
  [breakpoints]="{ '1199px': '75vw', '575px': '90vw' }"
  [draggable]="false"
  [resizable]="false"
  styleClass="image-modal"
>
  <div class="flex justify-content-center">
    <img
      [ngSrc]="modalImageUrl!"
      [alt]="getFieldLabel('image')"
      class="w-full max-h-30rem object-contain"
    />
  </div>
</p-dialog>
