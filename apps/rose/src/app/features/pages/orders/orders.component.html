<app-navbar />

<section class="orders-page">
  <h2 class="ordersTitle">Orders</h2>

  @if (orders && orders.length > 0) {
    <div class="orders-container">
      @for (order of orders; track order._id) {
        <div class="order-card">
          <div class="order-header">
            <span class="order-number">Order #{{ order.orderNumber }}</span>
            <span class="order-date">{{ order.createdAt | date: 'd MMMM, y \at h:mm a' }}</span>
          </div>

          <div class="order-status-section">
            <div class="status-left">
              <span class="total-label">Total Price:</span>
              <span class="bold">{{ order.totalPrice | currency:'EGP':'symbol' }}</span>
              <span *ngIf="order.isPaid" class="paid-badge">
                <i class="pi pi-check-circle"></i> Paid
              </span>
            </div>

            <div class="status-right">
              <span class="status-label">Status:</span>
              <span class="state-badge" [ngClass]="{
                'green': order.state === 'done',
                'blue': order.state === 'in progress',
                'red': order.state === 'cancelled'
              }">
                {{ order.state }}
              </span>
            </div>
          </div>

          <div class="order-extra-details">
            <p><strong>Payment Method:</strong> {{ order.paymentType }}</p>
            <p><strong>Delivery Status:</strong>
              <span [ngClass]="{ 'delivered': order.isDelivered, 'cancelled': !order.isDelivered }">
                <i class="pi" [ngClass]="order.isDelivered ? 'pi-check' : 'pi-ban'"></i>
                {{ order.isDelivered ? 'Delivered' : 'Canceled' }}
              </span>
            </p>
            <p><strong>Order Items:</strong></p>
          </div>

          <div class="order-content">
            <div class="order-items-wrapper"
                 [class.collapsed]="!isExpanded(order._id) && order.orderItems.length > 2"
                 [class.faded-mask]="!isExpanded(order._id) && order.orderItems.length > 2">
              <div class="order-items">
                @for (item of getVisibleOrderItems(order); track item._id) {
                  <div class="order-item">
                    <img [src]="item.product.imgCover" [alt]="item.product.title" />
                    <div class="item-details">
                      <p class="product-title">{{ item.product.title }}</p>
                      <p class="rating">‚≠ê Rating: {{ item.product.rateAvg || 5 }}/5 ({{ item.product.rateCount || 0 }} ratings)</p>
                      <p class="qty">(x{{ item.quantity }})</p>
                      <p class="price">{{ item.price | currency:'EGP' }}</p>
                    </div>
                  </div>
                }
              </div>
            </div>

            @if (order.orderItems.length > 2) {
              <div class="show-more-container">
                <button class="show-more-btn" (click)="toggleShowAll(order._id)">
                  {{ isExpanded(order._id) ? 'Show Less' : 'Show All' }}
                  <i class="pi" [ngClass]="isExpanded(order._id) ? 'pi-angle-up' : 'pi-angle-down'"></i>
                </button>
              </div>
            }
          </div>
        </div>
      }
    </div>
  } @else {
    <p class="no-orders">No orders found.</p>
  }
</section>

<app-footer />